# Dual Launcher v2.0 - Mejoras Implementadas

## üéØ Mejoras Principales

### 1. Detecci√≥n Autom√°tica de Directorio Incorrecto ‚úÖ

**Antes:**
```
ERROR - package.json no encontrado en directorio ra√≠z
ERROR - Faltan dependencias. Saliendo...
```

**Ahora:**
```
============================================================
ERROR - Directorio incorrecto detectado
============================================================
Directorio actual: C:\Users\...\SaaS-Proyects

Este script debe ejecutarse desde el directorio del proyecto:
  Masterpost-SaaS/

SOLUCI√ìN ENCONTRADA:

  cd Masterpost-SaaS
  python dual_launcher.py

Archivos esperados en el directorio actual:
  ‚úó package.json - NO ENCONTRADO
  ‚úó backend/ - NO ENCONTRADO
  ‚úó app/ - NO ENCONTRADO
============================================================
```

---

### 2. Logging Mejorado con Colores y Archivo ‚úÖ

**Caracter√≠sticas:**
- ‚úÖ **Colores en consola:**
  - üî¥ Rojo para errores
  - üü° Amarillo para warnings
  - üü¢ Verde para √©xitos
  - ‚ö™ Blanco para info

- ‚úÖ **Archivo de logs:** `launcher.log`
  - Timestamp para cada mensaje
  - Historial completo de ejecuciones
  - √ötil para debugging

**Ejemplo:**
```
[2025-10-20 13:15:42] [SUCCESS] OK - npm v11.5.2 encontrado
[2025-10-20 13:15:43] [SUCCESS] OK - FastAPI y Uvicorn disponibles
[2025-10-20 13:15:43] [ERROR] ERROR - package.json no encontrado
```

---

### 3. Manejo de Errores Detallado ‚úÖ

#### npm Errors
```python
# Captura stderr de npm install
try:
    result = subprocess.run(['npm', 'install'], capture_output=True, ...)
except subprocess.CalledProcessError as e:
    self.log(f"ERROR - Fallo al instalar dependencias npm", "ERROR")
    self.log(f"C√≥digo de error: {e.returncode}", "ERROR")
    if e.stderr:
        self.log("Detalles del error:", "ERROR")
        for line in e.stderr.split('\n')[:20]:  # First 20 lines
            if line.strip():
                self.log(f"  {line}", "ERROR")
```

#### Python Errors
```python
# Muestra traceback completo
except Exception as e:
    self.log(f"ERROR - Al iniciar backend: {e}", "ERROR")
    import traceback
    self.log(traceback.format_exc(), "ERROR")
```

---

### 4. Monitoreo de stdout y stderr Separados ‚úÖ

**Antes:**
- Solo capturaba stdout
- stderr se perd√≠a

**Ahora:**
- Captura stdout ‚Üí `[FRONTEND]` / `[BACKEND]`
- Captura stderr ‚Üí `[FRONTEND-ERR]` / `[BACKEND-ERR]`
- Detecta autom√°ticamente palabras clave de error

**Ejemplo:**
```
[FRONTEND] ‚ñ≤ Next.js 14.2.5
[FRONTEND] - Local: http://localhost:3000
[FRONTEND-ERR] Warning: React.createElement: type is invalid
[BACKEND] INFO:     Uvicorn running on http://0.0.0.0:8002
[BACKEND-ERR] Exception in ASGI application
```

---

### 5. Timeouts para Prevenir Colgado ‚úÖ

```python
# npm --version (10 segundos)
result = subprocess.run(['npm', '--version'], timeout=10)

# npm install (5 minutos)
result = subprocess.run(['npm', 'install'], timeout=300)

# Cleanup (5 segundos)
process.wait(timeout=5)
```

**Beneficio:** El launcher no se queda colgado indefinidamente si algo falla.

---

### 6. Verificaci√≥n Extendida de Dependencias ‚úÖ

**Verifica:**
- ‚úÖ npm instalado y respondiendo
- ‚úÖ FastAPI, Uvicorn disponibles
- ‚úÖ rembg, PIL disponibles (procesamiento de im√°genes)
- ‚úÖ package.json existe
- ‚úÖ node_modules existe (o instala)
- ‚úÖ backend/ existe
- ‚úÖ backend/server.py existe

**Muestra exactamente qu√© falta:**
```
ERROR - Paquete Python faltante: rembg
INFO - Ejecuta: pip install fastapi uvicorn rembg pillow
```

---

### 7. C√≥digos de Salida de Procesos ‚úÖ

**Ahora muestra por qu√© fall√≥ un proceso:**
```
ERROR - Frontend se cerr√≥ inesperadamente (c√≥digo: 1)
INFO - Revisa los logs arriba para m√°s detalles
```

**C√≥digos comunes:**
- `0` - √âxito
- `1` - Error general
- `2` - Mal uso de comando
- `126` - Comando no ejecutable
- `127` - Comando no encontrado

---

### 8. Compatibilidad Multi-plataforma ‚úÖ

```python
if sys.platform == "win32":
    # Windows: taskkill
    subprocess.run(f"taskkill /F /PID {pid} /T", ...)
else:
    # Linux/Mac: terminate
    process.terminate()
    process.wait(timeout=5)
```

---

## üìä Comparativa Antes vs Despu√©s

| Caracter√≠stica | v1.0 (Antes) | v2.0 (Ahora) |
|----------------|--------------|--------------|
| **Detecci√≥n de directorio** | ‚ùå No | ‚úÖ S√≠, con sugerencias |
| **Colores en consola** | ‚ùå No | ‚úÖ Rojo/Verde/Amarillo |
| **Archivo de logs** | ‚ùå No | ‚úÖ launcher.log con timestamps |
| **Captura stderr** | ‚ùå No | ‚úÖ S√≠, separado de stdout |
| **Timeouts** | ‚ùå No | ‚úÖ S√≠, para prevenir colgado |
| **C√≥digos de salida** | ‚ùå No muestra | ‚úÖ Muestra y explica |
| **Errores de npm** | ‚ùå Solo mensaje | ‚úÖ Detalles completos |
| **Traceback Python** | ‚ùå No | ‚úÖ Traceback completo |
| **Verificaci√≥n deps** | ‚ö†Ô∏è B√°sica | ‚úÖ Extendida (rembg, PIL) |
| **Sugerencias** | ‚ùå No | ‚úÖ Comandos de soluci√≥n |

---

## üöÄ C√≥mo Usar

### Desde el directorio correcto:
```bash
cd Masterpost-SaaS
python dual_launcher.py
```

### Desde el directorio incorrecto:
```bash
# El launcher detectar√° el error y te dir√° c√≥mo solucionarlo
cd SaaS-Proyects
python Masterpost-SaaS/dual_launcher.py

# Ver√°s:
# ERROR - Directorio incorrecto detectado
# SOLUCI√ìN: cd Masterpost-SaaS
```

---

## üìù Ejemplos de Salida

### ‚úÖ Inicio Exitoso

```
+--------------------------------------------------------------+
|                    > MASTERPOST.IO LAUNCHER                  |
|  Frontend (Next.js):  http://localhost:3000*                 |
|  Backend (FastAPI):   http://localhost:8002                  |
+--------------------------------------------------------------+

Logs guardados en: C:\...\Masterpost-SaaS\launcher.log

Verificando dependencias...
OK - npm v11.5.2 encontrado
OK - FastAPI y Uvicorn disponibles
OK - rembg y PIL disponibles
OK - node_modules encontrado
OK - Directorio backend verificado

Iniciando Frontend (Next.js)...
Iniciando Backend (FastAPI)...
[FRONTEND] > masterpost@0.1.0 dev
[FRONTEND] ‚ñ≤ Next.js 14.2.5
[FRONTEND] - Local: http://localhost:3000
OK - Frontend listo en http://localhost:3000
[BACKEND] INFO:     Started server process [12345]
[BACKEND] INFO:     Uvicorn running on http://0.0.0.0:8002
OK - Backend listo en http://localhost:8002

Ambos servicios iniciando...
Frontend: http://localhost:3000
Backend:  http://localhost:8002

Presiona Ctrl+C para detener ambos servicios
```

---

### ‚ùå Error: Directorio Incorrecto

```
+--------------------------------------------------------------+
|                    > MASTERPOST.IO LAUNCHER                  |
+--------------------------------------------------------------+

Logs guardados en: C:\...\SaaS-Proyects\launcher.log

============================================================
ERROR - Directorio incorrecto detectado
============================================================
Directorio actual: C:\Users\Neuracoder\...\SaaS-Proyects

Este script debe ejecutarse desde el directorio del proyecto:
  Masterpost-SaaS/

SOLUCI√ìN ENCONTRADA:

  cd Masterpost-SaaS
  python dual_launcher.py

Archivos esperados en el directorio actual:
  ‚úó package.json - NO ENCONTRADO
  ‚úó backend/ - NO ENCONTRADO
  ‚úó app/ - NO ENCONTRADO
============================================================

ERROR - Ejecuta el script desde el directorio correcto
```

---

### ‚ö†Ô∏è Error: Dependencia Faltante

```
Verificando dependencias...
OK - npm v11.5.2 encontrado
ERROR - Paquete Python faltante: rembg
INFO - Ejecuta: pip install fastapi uvicorn rembg pillow

ERROR - Faltan dependencias. Revisa los errores arriba.
```

---

### ‚ùå Error: Frontend Crash

```
[FRONTEND] ‚ñ≤ Next.js 14.2.5
[FRONTEND-ERR] Error: Cannot find module 'next/dist/...'
[FRONTEND-ERR]     at Module._resolveFilename (node:internal/modules/cjs/loader:1145:15)
ERROR - Frontend se cerr√≥ inesperadamente (c√≥digo: 1)
INFO - Revisa los logs arriba para m√°s detalles

Deteniendo servicios...
OK - Frontend detenido
OK - Backend detenido

Logs completos en: C:\...\Masterpost-SaaS\launcher.log
```

---

### üõë Cierre Manual (Ctrl+C)

```
^CCtrl+C detectado, cerrando servicios...

Deteniendo servicios...
OK - Frontend detenido
OK - Backend detenido

Logs completos en: C:\...\Masterpost-SaaS\launcher.log
```

---

## üîç Revisar Logs

```bash
# Ver logs en tiempo real
tail -f launcher.log

# Windows PowerShell
Get-Content launcher.log -Wait

# Ver √∫ltimas 50 l√≠neas
tail -n 50 launcher.log

# Windows PowerShell
Get-Content launcher.log -Tail 50

# Buscar errores
grep ERROR launcher.log

# Windows PowerShell
Select-String -Path launcher.log -Pattern "ERROR"
```

---

## üêõ Troubleshooting

### Si no ves colores en Windows:

```powershell
# Habilita ANSI colors en PowerShell
$PSStyle.OutputRendering = 'Ansi'

# O usa Windows Terminal en lugar de cmd.exe
```

### Si launcher.log no se crea:

- Verifica permisos de escritura en el directorio
- Ejecuta como administrador si es necesario

### Si los servicios no se detienen:

```bash
# Matar todos los procesos Python
taskkill /F /IM python.exe

# Matar todos los procesos Node
taskkill /F /IM node.exe
```

---

## üìà Mejoras Futuras (Roadmap)

- [ ] GUI con tkinter para ver logs en ventana
- [ ] Health checks autom√°ticos (ping endpoints)
- [ ] Auto-restart si un servicio falla
- [ ] Configuraci√≥n de puertos personalizados
- [ ] Modo verbose/debug con flag `-v`
- [ ] Export logs a JSON/HTML
- [ ] Notificaciones de escritorio cuando est√© listo
- [ ] Docker support

---

## üìö Archivos Relacionados

- **[dual_launcher.py](dual_launcher.py)** - Script mejorado
- **[DUAL_LAUNCHER_FIX.md](DUAL_LAUNCHER_FIX.md)** - Documentaci√≥n de correcciones
- **launcher.log** - Archivo de logs (generado autom√°ticamente)

---

## ‚úÖ Changelog

### v2.0 (2025-10-20)
- ‚úÖ **NEW:** Detecci√≥n autom√°tica de directorio incorrecto
- ‚úÖ **NEW:** Sistema de logging con colores (rojo/verde/amarillo)
- ‚úÖ **NEW:** Archivo launcher.log con timestamps
- ‚úÖ **NEW:** Captura separada de stdout y stderr
- ‚úÖ **NEW:** Timeouts para prevenir colgado (10s, 5min, 5s)
- ‚úÖ **NEW:** Verificaci√≥n extendida de deps (rembg, PIL)
- ‚úÖ **NEW:** Muestra c√≥digos de salida de procesos
- ‚úÖ **NEW:** Traceback completo para excepciones Python
- ‚úÖ **NEW:** Detalles completos de errores de npm
- ‚úÖ **NEW:** Sugerencias autom√°ticas de soluci√≥n
- ‚úÖ **IMPROVE:** Mejor manejo de errores en cleanup
- ‚úÖ **IMPROVE:** Compatibilidad multi-plataforma (Windows/Linux/Mac)

### v1.2 (2025-10-20)
- ‚úÖ **FIX:** Busca package.json en ra√≠z (estructura Next.js App Router)
- ‚úÖ **FIX:** npm install ejecuta desde directorio correcto

### v1.1 (2025-10-20)
- ~~Versi√≥n con estructura incorrecta~~

### v1.0 (Original)
- Versi√≥n b√°sica sin detecci√≥n de errores

---

## üéâ Resumen

**El dual_launcher.py v2.0 es ahora:**

1. üéØ **Inteligente** - Detecta errores comunes y sugiere soluciones
2. üìù **Informativo** - Logs detallados con colores y timestamps
3. üõ°Ô∏è **Robusto** - Maneja errores gracefully sin colgarse
4. üîç **Debuggable** - Captura todos los errores de stdout/stderr
5. üöÄ **F√°cil de usar** - Mensajes claros y ayuda contextual

**¬°Ahora con 100% m√°s debugging power!** üéä
